<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jeleren.dao.IImageInfoDao">
    <insert id="add" parameterType="com.jeleren.bean.ImageInfo">
            insert into images (image, name, cates, user_id, description, keywords, if_active, add_time, like_num, collect_num) value (#{image}, #{name}, #{cates}, #{user_id}, #{description}, #{keywords}, #{if_active}, #{add_time}, 0, 0)
    </insert>
    <select id="searchImage" resultType="com.jeleren.bean.ImageInfo">
        SELECT DISTINCT images.*
        FROM images
        inner JOIN image_keywords ON images.id = image_keywords.id
        <where>
            <if test="sList.pattern!=null">
                images.pattern = #{sList.pattern}
            </if>
            <if test="sList.cateList.size()>0">
                and images.cates in
                <foreach collection="sList.cateList" item="cate" open="(" separator="," close=")">
                    #{cate}
                </foreach>
            </if>
            <if test="sList.keyword!=null">
                and image_keywords.keyword like concat('%',#{sList.keyword},'%')
            </if>
        </where>
        order by images.add_time ${sList.seq}
    </select>

    <update id="editImageLikeNum">
        update images set
        <if test="record == 'delete'">
            like_num = like_num - 1
        </if>
        <if test="record == 'add'">
            like_num = like_num + 1
        </if>
        where id = #{image}
    </update>

</mapper>